@{
    ViewBag.Title = "Upload";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section scripts {
    <script src="~/scripts/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="~/js/jquery-ui-1.8.2.custom.min.js" type="text/javascript"></script>
    <script src="~/js/i18n/grid.locale-it.js" type="text/javascript"></script>
    <script src="~/js/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script type="text/javascript">
    $(function () {
        var nascondiRating = @{if(ViewBag.Ambiente == "MONOAZIENDALE"){<text>true</text>}else{<text>false</text>}};
        // Here we set the altRows option globally
        jQuery.extend(jQuery.jgrid.defaults, { altRows: true, emptyrecords: "Nessun risultato", pgtext: "Pagina {0} di {1}", recordtext: "Visualizza {0} - {1} di {2}", autowidth: true });

        $(window).bind('resize', function () {
            $("#preferiti").setGridWidth($("#preferitiMonitoraggioContainer").width(), true);
        }).trigger('resize');
        var idCentro = $('#centroRP').val();
        $("#preferiti").jqGrid({
            url: './Uploadresult',
            datatype: 'json',
            height: 'auto',
            multiselect: true,
            autowidth: true,
            shrinkToFit: true,
            altRows: true,
            rowNum: 10000,
            mtype: 'POST',
            onCellSelect: function (rowid, iCol, cellcontent, e) {
                switch (iCol) {

                    case 0:
                    case 1:
                        var idAzienda = $("#preferiti").jqGrid('getCell', rowid, 'PartitaIva'); ;
                        $.post("../LoggedHome/GetDettaglioAnagrafica", { piva: idAzienda },
                                        function (data) {
                                            if (data != '') {
                                                $("div#dialog-anagrafica").html(data);
                                                $("div#dialog-anagrafica").dialog({
                                                    open: function (event, ui) {
                                                        $(".ui-dialog-titlebar-close").hide();
                                                    },
                                                    resizable: false,
                                                    closeOnEscape: false,
                                                    width: $(window).width() * 0.8,
                                                    height: $(window).height() * 0.8,
                                                    modal: true,
                                                    buttons: {
                                                        "Chiudi": function () {
                                                            $(this).dialog("close");

                                                        }
                                                    }
                                                });
                                            }
                                        });
                        break;
                    case 5:
                        var idAzienda = $("#preferiti").jqGrid('getCell', rowid, 'PartitaIva');
                        var codiceRapporto = "CDWS_" + $("#preferiti").jqGrid('getCell', rowid, 'CodiceRapporto');
                        var rapportoLink = rowid[1];
                        var link = '@Url.Action("Check","PDF")';
                        window.open(link + '/' + codiceRapporto, '', '');

                        break;
                }
            },
            repeatitems: false,
            colNames: ['PIVA', 'Rag.Soc.'],
            colModel: [
                { name: 'PartitaIva', index: 'id', align: "center", classes: "puntatore", key: true },
                { name: 'RagioneSociale', index: 'RagioneSociale', align: "center", classes: "puntatore" },
   	],
            jsonReader: { repeatitems: false },
            pager: '#pagerPreferiti',
            viewrecords: true,
            sortname: 'RagioneSociale',
            viewrecords: true,
            pgbuttons: true,
            pginput: true,
            sortorder: "desc",
            caption: "<span id='filtraValoriPreferiti'>Ricerca</span><a style='text-decoration:none' href='@Url.Action("GetGlobalReport", "CervedController")'><span id='reportPreferiti'><i class='fa fa-file-excel-o'></i>&nbsp;Report</span></a>"
        });

        function datetostring(cellvalue) {
            var apppo = "";
            cellvalue.toString();
        }

        function fidoFormatter(cellvalue, options, rowObject) {
            var display = "";
            if (cellvalue == "0") {
                display = "N.D.";
            }
            else {
                display = cellvalue;
            }

            return display;

        }

        $("#preferiti").jqGrid('navGrid', '#pagerPreferiti', { edit: false, add: false, del: false });



        $('.ui-icon-seek-next').attr('alt', 'Pagina Successiva');
        $('.ui-icon-seek-next').attr('title', 'Pagina Successiva');

        $('.ui-icon-seek-prev').attr('alt', 'Pagina Precedente');
        $('.ui-icon-seek-prev').attr('title', 'Pagina Precedente');

        $('.ui-icon-seek-end').attr('alt', 'Ultima Pagina');
        $('.ui-icon-seek-end').attr('title', 'Ultima Pagina');

        $('.ui-icon-seek-first').attr('alt', 'Prima Pagina');
        $('.ui-icon-seek-first').attr('title', 'Prima Pagina');

    });
    </script>
}
@section additionalCss {
    <link rel="stylesheet" type="text/css" media="screen" href="~/css/redmond/jquery-ui-1.8.2.custom.css" />
    <link rel="stylesheet" type="text/css" media="screen" href="~/css/ui.jqgrid.css" />
}

@section loggedUser {
    @RenderPage("~/Views/Shared/_LoggedUser.cshtml")
}
@section navbar {
    @RenderPage("~/Views/Shared/_NavBar.cshtml")
}
<br />
<div id="preferitiMonitoraggioContainer">
    <h2>RICHIESTE REPORT MERCATO</h2>
    <table id="preferiti"></table>
    <div id="pagerPreferiti"></div>
</div><br /><br />
<div id="dialog-anagrafica" style="display:none">
</div>
<div id="dialog-valutazione" style="display:none">
</div>
<script type="text/javascript">
    $(function () {
        $('#filtraValoriPreferiti').click(function () {
            $("#preferiti").jqGrid(
                'searchGrid',
                {
                    caption: "Cerca in Upload",
                    sopt: ['cn'],
                    odata: ['contiene']
                });
        });

    });
</script>
