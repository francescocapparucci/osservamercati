@using CentraleRischiR2Library;
@{
    ViewBag.Title = "Reportistica";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section scripts {
<script src="~/scripts/jquery-1.7.1.min.js" type="text/javascript"></script>
<script src="~/js/jquery-ui-1.8.2.custom.min.js" type="text/javascript"></script>
<script src="~/js/i18n/grid.locale-it.js" type="text/javascript"></script>
<script src="~/js/jquery.jqGrid.min.js" type="text/javascript"></script>
<script src="~/js/jquery.ui.datepicker-it.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {



        $('#centroRP').change(function () {            
            var idCentro = $('#centroRP').val();
            $.post("./ElencoOperatoriCentro", {
                'idcentro': idCentro
            },
          function (data) {
              var sel = $("#operatoreRP");
              sel.empty();              
              for (var i = 0; i < data.length; i++) {
                  sel.append('<option value="' + data[i].m01_codice + '">' + data[i].m01_ragionesociale + '</option>');
              }
              sel.append('<option value="0">--Selezionare Operatore--</option>');
        }, "json");
        });

        $('#centroCRC').change(function () {
            var idCentro = $('#centroCRC').val();
            $.post("./ElencoOperatoriCentro", {
                'idcentro': idCentro
            },
          function (data) {
              var sel = $("#operatoreCRC");
              sel.empty();              
              for (var i = 0; i < data.length; i++) {
                  sel.append('<option value="' + data[i].m01_codice + '">' + data[i].m01_ragionesociale + '</option>');
              }
              sel.append('<option selected value="0">--Selezionare Operatore--</option>');
          }, "json");
        });

        $('#centroGlobale').change(function () {
            var idCentro = $('#centroGlobale').val();
            $.post("./ElencoOperatoriCentro", {
                'idcentro': idCentro
            },
          function (data) {
              var sel = $("#operatoreGlobale");
              sel.empty();
              for (var i = 0; i < data.length; i++) {
                  sel.append('<option value="' + data[i].m01_codice + '">' + data[i].m01_ragionesociale + '</option>');
              }
              sel.append('<option value="0">--Selezionare Operatore--</option>');
          }, "json");
        });


        $("#homeTabsReport").tabs();

        $("#dataInizio,#dataFine,#dataInizioCRC,#dataFineCRC,#dataInizioRP,#dataFineRP,#dataInizioCN,#dataFineCN").datepicker($.datepicker.regional['it']);
        $("#dataInizio,#dataFine,#dataInizioCRC,#dataFineCRC,#dataInizioRP,#dataFineRP,#dataInizioCN,#dataFineCN").datepicker('option', 'dateFormat', 'dd/mm/yy');


        $('#pva').autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: './GetAnagraficaPivaOsservatorioAC',
                    data: { query: request.term },
                    dataType: 'json',
                    type: 'POST',
                    success: function (data) {
                        response($.map(data, function (item) {
                            return {
                                label: item.PartitaIva,
                                value: item.RagioneSociale
                            }
                        }));
                    }
                })
            },
            select: function (event, ui) {
                $('#pva').val(ui.item.label);
                $('#ragsoc').val(ui.item.value);
                return false;
            },
            minLength: 3
        });

        $('#ragsoc').autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: './GetAnagraficaRagSocOsservatorioAC',
                    data: { query: request.term },
                    dataType: 'json',
                    type: 'POST',
                    success: function (data) {
                        response($.map(data, function (item) {
                            return {
                                label: item.RagioneSociale,
                                value: item.PartitaIva
                            }
                        }));
                    }
                })
            },
            select: function (event, ui) {
                $('#pva').val(ui.item.value);
                $('#ragsoc').val(ui.item.label);
                return false;
            },
            minLength: 3
        });

        $('#pva').click(function () {
            $('#ragsoc').val('');
            $('#pva').val('');
        }
    );

        $('#ragsoc').click(function () {
            $('#ragsoc').val('');
            $('#pva').val('');
        }
    );


        $('#btnRichiesta1').click(function () {
            //alert('premuto' + $('#pva').val());            
            $.post("./InserisciRichiesteReportFornitore", { piva: $('#pva').val(), dataInizio: $('#dataInizio').val(), dataFine: $('#dataFine').val() },
                                        function (data) {
                                            if (data != '') {
                                                $("div#dialog-report").dialog({
                                                    open: function (event, ui) {
                                                        $(".ui-dialog-titlebar-close").hide();
                                                    },
                                                    resizable: false,
                                                    closeOnEscape: false,                                                    
                                                    modal: true,
                                                    buttons: {
                                                        "Chiudi": function () {
                                                            piva: $('#pva').val('');
                                                            piva: $('#ragsoc').val('');
                                                            $(this).dialog("close");

                                                        }
                                                    }
                                                });
                                            }
                                        });
        });


        $('#btnRichiestaCRC').click(function () {
            //alert('premuto' + $('#pva').val());            
            $.post("./InserisciRichiesteReportCRC", { codice: $('#operatoreCRC').val(), dataInizio: $('#dataInizioCRC').val(), dataFine: $('#dataFineCRC').val(), centro: $('#centroCRC').val() },
                                        function (data) {
                                            if (data != '') {
                                                $("div#dialog-report").dialog({
                                                    open: function (event, ui) {
                                                        $(".ui-dialog-titlebar-close").hide();
                                                    },
                                                    resizable: false,
                                                    closeOnEscape: false,
                                                    modal: true,
                                                    buttons: {
                                                        "Chiudi": function () {
                                                            piva: $('#pva').val('');
                                                            piva: $('#ragsoc').val('');
                                                            $(this).dialog("close");

                                                        }
                                                    }
                                                });
                                            }
                                        });
        });

        $('#btnRichiestaRP').click(function () {
            //alert('premuto' + $('#pva').val());            
            $.post("./InserisciRichiesteReportRP", { codice: $('#operatoreRP').val(), dataInizio: $('#dataInizioRP').val(), dataFine: $('#dataFineRP').val() },
                                        function (data) {
                                            if (data != '') {
                                                $("div#dialog-report").dialog({
                                                    open: function (event, ui) {
                                                        $(".ui-dialog-titlebar-close").hide();
                                                    },
                                                    resizable: false,
                                                    closeOnEscape: false,
                                                    modal: true,
                                                    buttons: {
                                                        "Chiudi": function () {                                                            
                                                            $(this).dialog("close");

                                                        }
                                                    }
                                                });
                                            }
                                        });
        });

        $('#btnRichiestaCN').click(function () {
            //alert('premuto' + $('#pva').val());            
            $.post("./InserisciRichiesteReportCN", { dataInizio: $('#dataInizioCN').val(), dataFine: $('#dataFineCN').val(), numeroAziende: $('#numeroAziendeCN').val() },
                                        function (data) {
                                            if (data != '') {
                                                $("div#dialog-report").dialog({
                                                    open: function (event, ui) {
                                                        $(".ui-dialog-titlebar-close").hide();
                                                    },
                                                    resizable: false,
                                                    closeOnEscape: false,
                                                    modal: true,
                                                    buttons: {
                                                        "Chiudi": function () {
                                                            $(this).dialog("close");

                                                        }
                                                    }
                                                });
                                            }
                                        });
        });

        $('#btnRichiestaGlobale').click(function () {
            //alert('premuto' + $('#pva').val());            
            $.post("./InserisciRichiesteReportGlobale", { codice: $('#operatoreGlobale').val() },
                                        function (data) {
                                            if (data != '') {
                                                $("div#dialog-report").dialog({
                                                    open: function (event, ui) {
                                                        $(".ui-dialog-titlebar-close").hide();
                                                    },
                                                    resizable: false,
                                                    closeOnEscape: false,
                                                    modal: true,
                                                    buttons: {
                                                        "Chiudi": function () {
                                                            $(this).dialog("close");

                                                        }
                                                    }
                                                });
                                            }
                                        });
        });


    });
        
</script>
}
@section sectionTitle{
<div id="title">
    <h1>Reportistica</h1>	
</div>
}
@section additionalCss {
<link rel="stylesheet" type="text/css" media="screen" href="~/css/redmond/jquery-ui-1.8.2.custom.css" />
<link rel="stylesheet" type="text/css" media="screen" href="~/css/ui.jqgrid.css" />
<style>
div#homeTabsReport select#operatoreRP,select#centroRP,select#operatoreCRC,select#centroCRC,input[type="search"],input[type="number"]{
    -webkit-appearance: textfield;
    background-color: white;
    border-image-source: initial;
    border-image-slice: initial;
    border-image-width: initial;
    border-image-outset: initial;
    border-image-repeat: initial;
    -webkit-rtl-ordering: logical;
    -webkit-user-select: text;
    cursor: auto;
    padding: 1px;
    border: 2px inset;
    height: 40px;
    font-size: 22px;
    width: 20%;
}
div#homeTabsReport input[type="number"]{    
    width: 5%;
}

div#homeTabsReport input[type=button] {
    background: #ACD6EF;
    margin-right: 20px;
    margin-top: 20px;
    width: 80px;
    height: 30px;
    font-size: 14px;
    /* font-weight: bold; */
    color: #fff;
    background-image: -webkit-gradient(linear, left top, left bottom, from(#f8b153), to(#DC9322));
    background-image: -moz-linear-gradient(top left 90deg, #f8b153 0%, #DC9322 100%);
    background-image: linear-gradient(top left 90deg, #f8b153 0%, #DC9322 100%);
    /* border-radius: 30px; */
    border: 1px solid #d68505;
    box-shadow: 0 1px 2px rgba(0, 0, 0, .3), inset 0 1px 0 rgba(255, 255, 255, .5);
    cursor: pointer;
}

div#homeTabsReport h3
{
    padding:15px;     
    display:inline;color:#555; padding-right:20px; font-weight:lighter;font-size:25px;
}   
div#homeTabsReport h2
{
    
    background: #014464;
    background: -moz-linear-gradient(center top , #0272A7, #013953) repeat scroll 0 0 rgba(0, 0, 0, 0);
    background: -webkit-gradient(linear, 0 0%, 0 100%, from(#0272A7), to(#013953));
    background-position: center center;
    background-repeat: no-repeat;
    height: 38px;
    min-width: 25%;
    max-width: 50%;
    color: #FFF;
    margin: 0 auto;
    line-height: 35px;
    font-weight: lighter;    
    -moz-border-radius: 5px;    
    -webkit-border-radius: 5px;    
}
</style>
}
@section loggedUser {
    @RenderPage("~/Views/Shared/_LoggedUser.cshtml")
}
@section navbar {
    @RenderPage("~/Views/Shared/_NavBar.cshtml")
}

@section searchForm {
    @RenderPage("~/Views/Shared/_SearchCerved.cshtml")
}
@section breadCrumb {
    @RenderPage("~/Views/Shared/_BreadCrumb.cshtml")    
}
<div id="homeTabsReport">
<ul>
    <li><a href="#reportFornitoreContainer">Fornitore</a></li>
    <li><a href="#reportCRCContainer">C.R.C.</a></li>
    <li><a href="#reportRPContainer">Risk Predictor</a></li>
    <li><a href="#reportCN">Classifica</a></li>
    <li><a href="#reportGlobaleContainer">Globale</a></li>
</ul>
<div id="reportFornitoreContainer">
    <h2>Report Fornitore</h2><br />
    <form action="" method="post"" name="frmSearchRFornitore" id="frmSearchRFornitore">
        <h3>Partita Iva:</h3>
        <input id="pva" type="search" value="@ViewBag.PartitaIva" />
        <h3>Ragione Sociale:</h3>
        <input id="ragsoc" type="search" value="@ViewBag.RagioneSociale" style="width:300px" /><br /><br />   
        <h3>Data Inizio:</h3>
        <input id="dataInizio" name="dataInizio" type="search" value='@ViewBag.DataInizio;' style="width:200px" />
        <h3>Data Fine:</h3>
        <input id="dataFine" name="dataFine" type="search" value='@ViewBag.DataFine;' style="width:200px" /><br /><br />
        <input type="button" id="btnRichiesta1" value="Richiedi">  
    </form>
</div>
<div id="reportCRCContainer">
    <h2>Report CRC</h2><br />    
    <form action="" method="post"" name="frmSearchRFornitore" id="frmSearchRFornitore">
        <h3>Centro:</h3>
        @{
            List<CentraleRischiR2Library.BridgeClasses.ElementoMercato> list = (List<CentraleRischiR2Library.BridgeClasses.ElementoMercato>)ViewBag.ElencoCentri;
            var items = new SelectList(list, "IdMercato", "Citta");
        }
        <select id="centroCRC">
        @foreach (var item in items)
        {

                <option value="@item.Value">
                    @item.Text 
                </option>                  
        }
        <option value="0">--Selezionare Centro--</option>                  
        </select>
        <h3>Operatore:</h3>
        <select id="operatoreCRC">
            <option value="0">--Selezionare Operatore--</option>                  
        </select><br /><br />   
        <h3>Data Inizio:</h3>
        <input id="dataInizioCRC" name="dataInizioCRC" type="search" value='@ViewBag.DataInizio;' style="width:200px" />
        <h3>Data Fine:</h3>
        <input id="dataFineCRC" name="dataFineCRC" type="search" value='@ViewBag.DataFine;' style="width:200px" /><br /><br />   
        <input type="button" id="btnRichiestaCRC" value="Richiedi">  
    </form>    
</div>
    <div id="reportRPContainer">
    <h2>Report Risk Predictor</h2><br />
    <form action="" method="post"" name="frmSearchRFornitore" id="frmSearchRFornitore">
        <h3>Centro:</h3>
        @{
            list = (List<CentraleRischiR2Library.BridgeClasses.ElementoMercato>)ViewBag.ElencoCentri;
            items = new SelectList(list, "IdMercato", "Citta");
        }
        <select id="centroRP">
        @foreach (var item in items)
        {

                <option value="@item.Value">
                    @item.Text 
                </option>                  
        }
        <option value="0">--Selezionare Centro--</option>                  
        </select>
        <h3>Operatore:</h3>
        <select id="operatoreRP">
            <option value="0">--Selezionare Operatore--</option>                  
        </select>><br /><br />   
        <h3>Data Inizio: </h3>
        <input id="dataInizioRP" name="dataInizioRP" type="search" value='@ViewBag.DataInizio;' style="width:200px" />
        <h3>Data Fine: </h3>
        <input id="dataFineRP" name="dataFineRP" type="search" value='@ViewBag.DataFine;' style="width:200px" /><br /><br />   
        <input type="button" id="btnRichiestaRP" value="Richiedi">  

    </form>    
</div>
    <div id="reportCN">
    <h2>Report Classifica Nazionale</h2><br />
    <form action="" method="post"" name="frmSearchRFornitore" id="frmSearchRFornitore">        
        <h3>Data Inizio: </h3>
        <input id="dataInizioCN" name="dataInizioCN" type="search" value='@ViewBag.DataInizio' style="width:200px" />
        <h3>Data Fine: </h3>
        <input id="dataFineCN" name="dataFineCN" type="search" value='@ViewBag.DataFine' style="width:200px" /><br /><br />      
        <h3>Numero Aziende: </h3>
        <input type="number" id="numeroAziendeCN" name="numeroAziendeCN" value='500' min="1" max="10000" /><br />
        <input type="button" id="btnRichiestaCN" value="Richiedi">  
    </form>
</div>
    <div id="reportGlobaleContainer">
        <h2>Report Globale</h2><br />
        <form action="" method="post" " name=" frmSearchRFornitore" id="frmSearchRFornitore">
            <h3>Centro:</h3>
            @{
                list = (List<CentraleRischiR2Library.BridgeClasses.ElementoMercato>)ViewBag.ElencoCentri;
                items = new SelectList(list, "IdMercato", "Citta");
            }
            <select id="centroGlobale">
                @foreach (var item in items)
                {

                    <option value="@item.Value">
                        @item.Text
                    </option>
                }
                <option value="0">--Selezionare Centro--</option>
            </select>
            <h3>Operatore:</h3>
            <select id="operatoreGlobale">
                <option value="0">--Selezionare Operatore--</option>
            </select><br /><br />
            <input type="button" id="btnRichiestaGlobale" value="Richiedi">
        </form>
    </div>
</div>
<div id="dialog-report" style="display:none">
    Il Report richiesto sarà elaborato e inviato alla vostra casella di posta elettronica.
</div>
<br />
